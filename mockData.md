temp = [[1513924066663, 27.9],
[1513949266668, 26.2],
[1513974466670, 22.2],
[1513999666671, 19.3],
[1514024866672, 15.8],
[1514050066673, 25.2],
[1514075266674, 30.1],
[1514100466675, 18.8], 
[1514125666675, 15.3],
[1514150866676, 19.7],
[1514176066678, 19],
[1514201266678, 28.3],
[1514226466680, 25.1],
[1514251666682, 22.5],
[1514276866683, 27],
[1514302066683, 23.6],
[1514327266685, 20.9],
[1514352466685, 26.4],
[1514377666686, 17.2],
[1514402866687, 31.8],
[1514428066687, 19.8],
[1514453266689, 30.5],
[1514478466692, 31.7],
[1514503666693, 23.8],
[1514528866696, 18.9],
[1514554066698, 28.9],
[1514579266700, 16.8],
[1514604466702, 29.4],
[1514629666704, 26.7],
[1514654866707, 19.5],
[1514680066709, 27.6],
[1514705266711, 29.9],
[1514730466714, 15.8],
[1514755666715, 31.2],
[1514780866716, 24.2],
[1514806066719, 27.7],
[1514831266722, 18.6],
[1514856466724, 15.8],
[1514881666724, 20.6],
[1514906866726, 15.1],
[1514932066726, 25.6],
[1514957266727, 15.5],
[1514982466731, 17.7],
[1515007666733, 21.3],
[1515032866736, 28.2],
[1515058066740, 21.2],
[1515083266743, 27.7],
[1515108466744, 15],
[1515133666746, 21],
[1515158866749, 28.9],
[1515184066750, 23],
[1515209266751, 23.4],
[1515234466753, 22.1],
[1515259666754, 15.1],
[1515284866756, 23.2],
[1515310066758, 27.9],
[1515335266760, 29.8],
[1515360466762, 22.1],
[1515385666764, 21.4],
[1515410866766, 26.7],
[1515436066767, 28.6],
[1515461266768, 19.8],
[1515486466770, 25.7],
[1515511666771, 25.2],
[1515536866772, 30.6],
[1515562066773, 21],
[1515587266774, 20.7],
[1515612466777, 20.9],
[1515637666779, 17.4],
[1515662866781, 29.3],
[1515688066783, 16.1],
[1515713266784, 25.3],
[1515738466785, 23.9],
[1515763666786, 28.2],
[1515788866787, 26],
[1515814066788, 23.5],
[1515839266790, 18.4],
[1515864466790, 30.8],
[1515889666793, 21.2],
[1515914866794, 24.7],
[1515940066794, 22.5],
[1515965266796, 28.6],
[1515990466797, 15.8],
[1516015666797, 22.7],
[1516040866800, 24.7],
[1516066066802, 21.3],
[1516091266803, 27.1],
[1516116466808, 21.3],
[1516141666810, 28.4],
[1516166866811, 16.2],
[1516192066812, 17.2],
[1516217266816, 27.9],
[1516242466819, 20.9],
[1516267666819, 31.2],
[1516292866820, 26],
[1516318066820, 18.8],
[1516343266823, 31.7],
[1516368466824, 31.2],
[1516393666826, 27.7],
[1516418866827, 30.1],
[1516444066827, 28.7],
[1516469266830, 17.5],
[1516494466831, 31.7],
[1516519666834, 15.1],
[1516544866835, 19],
[1516570066836, 17.6],
[1516595266837, 29.5],
[1516620466838, 23.7],
[1516645666839, 15.7],
[1516670866840, 28.8],
[1516696066842, 17.1],
[1516721266843, 16.1],
[1516746466845, 26.6],
[1516771666847, 15.8],
[1516796866848, 18.5],
[1516822066850, 26.9],
[1516847266851, 15.1],
[1516872466853, 31.6],
[1516897666854, 22.3],
[1516922866855, 25.2]]

valve = [[1513924066663, true],
[1513949266668, true],
[1513974466670, true],
[1513999666671, false],
[1514024866672, false],
[1514050066673, true],
[1514075266674, false],
[1514100466675, false], 
[1514125666675, false],
[1514150866676, false],
[1514176066678, false],
[1514201266678, true],
[1514226466680, true],
[1514251666682, true],
[1514276866683, true],
[1514302066683, true],
[1514327266685, true],
[1514352466685, true],
[1514377666686, false],
[1514402866687, false],
[1514428066687, false],
[1514453266689, false],
[1514478466692, false],
[1514503666693, true],
[1514528866696, false],
[1514554066698, true],
[1514579266700, false],
[1514604466702, true],
[1514629666704, true],
[1514654866707, false],
[1514680066709, true],
[1514705266711, true],
[1514730466714, false],
[1514755666715, false],
[1514780866716, true],
[1514806066719, true],
[1514831266722, false],
[1514856466724, false],
[1514881666724, true],
[1514906866726, false],
[1514932066726, true],
[1514957266727, false],
[1514982466731, false],
[1515007666733, true],
[1515032866736, true],
[1515058066740, true],
[1515083266743, true],
[1515108466744, false],
[1515133666746, true],
[1515158866749, true],
[1515184066750, true],
[1515209266751, true],
[1515234466753, true],
[1515259666754, false],
[1515284866756, true],
[1515310066758, true],
[1515335266760, true],
[1515360466762, true],
[1515385666764, true],
[1515410866766, true],
[1515436066767, true],
[1515461266768, false],
[1515486466770, true],
[1515511666771, true],
[1515536866772, false],
[1515562066773, true],
[1515587266774, true],
[1515612466777, true],
[1515637666779, false],
[1515662866781, true],
[1515688066783, false],
[1515713266784, true],
[1515738466785, true],
[1515763666786, true],
[1515788866787, true],
[1515814066788, true],
[1515839266790, false],
[1515864466790, false],
[1515889666793, true],
[1515914866794, true],
[1515940066794, true],
[1515965266796, true],
[1515990466797, false],
[1516015666797, true],
[1516040866800, true],
[1516066066802, true],
[1516091266803, true],
[1516116466808, true],
[1516141666810, true],
[1516166866811, false],
[1516192066812, false],
[1516217266816, true],
[1516242466819, true],
[1516267666819, false],
[1516292866820, true],
[1516318066820, false],
[1516343266823, false],
[1516368466824, false],
[1516393666826, true],
[1516418866827, false],
[1516444066827, true],
[1516469266830, false],
[1516494466831, false],
[1516519666834, false],
[1516544866835, false],
[1516570066836, false],
[1516595266837, true],
[1516620466838, true],
[1516645666839, false],
[1516670866840, true],
[1516696066842, false],
[1516721266843, false],
[1516746466845, true],
[1516771666847, false],
[1516796866848, false],
[1516822066850, true],
[1516847266851, false],
[1516872466853, false],
[1516897666854, true],
[1516922866855, true]
]

let daily = temp.reduce((acc, t) =>  {
    let _t = new Date(t[0])
    let year = _t.getFullYear()
    let month = _t.getMonth() + 1
     month = month < 10 ? "0"+month : ""+month
    let day = _t.getDate()
     day = day < 10 ? "0"+day : ""+day
    let date = "" + year + "-" + month + "-" + day
    if (!acc[date]) acc[date] = { date: new Date(date).getTime(), data: [], min: null, max: null, average: null }
    acc[date].data = acc[date].data.concat(t[1])
    acc[date].average = parseFloat((acc[date].data.reduce((acc,t) => {return acc = acc + t})/acc[date].data.length).toFixed(1))
    acc[date].min = acc[date].data.sort((a, b) => {return a-b} )[0]
    acc[date].max = acc[date].data.sort((a, b) => {return b-a} )[0]
    return acc
  }, {}
)
console.log("daily: ", daily)

getWeek = (millis) => {
  firstDayOfTheYear = new Date(millis).getFullYear()
  giorniPassatiDallInizioDellAnno = ( (new Date(millis - new Date(firstDayOfTheYear.toString()).getTime())) / 86400000 ) + 1
  //2- => la settimana inizia di lunedÃ¬, 1- => la settimana inizia di domenica
  primiGiorniDellAnno = 2-new Date(firstDayOfTheYear.toString()).getDay()
  week = Math.trunc((giorniPassatiDallInizioDellAnno-primiGiorniDellAnno)/7) + 1
  return week
}

let weekly = Object.keys(daily).reduce((acc, t) =>  {
    let _t = daily[t].date
    let week = new Date(_t).getFullYear()+ "-" + getWeek(_t)
    if (!acc[week]) acc[week] = { date: new Date(_t).getTime(), week: getWeek(_t), data: [], min: null, max: null, average: null }
    acc[week].data = acc[week].data.concat(daily[t].average)
    acc[week].average = parseFloat((acc[week].data.reduce((acc,t) => {return acc = acc + t})/acc[week].data.length).toFixed(1))
    acc[week].min = acc[week].data.sort((a, b) => {return a-b} )[0]
    acc[week].max = acc[week].data.sort((a, b) => {return b-a} )[0]
    return acc
  }, {}
)
  console.log("weekly: ", weekly)
